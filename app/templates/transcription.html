<html>
    <head>
        <title>Transcription for {{title}}</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
        <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}">
    </head>
    <body>
        <div class="container-fluid">
            <div style="margin: 0 auto;max-width: 1024px;">
                <h1 class="txt-dark">{{title}}</h1>
                <div style="height:20px;"></div>

                <audio controls="controls" id="audioplayer">
                    <source src="/getFile/{{id}}" type="audio/wav">
                </audio>
                
                <div style="height:20px;"></div>

                {% for item in transcription %}
                <div class="segment" id="segment{{loop.index0}}" style="font-weight: normal;">
                    <p id="0">
                        {{item[0] | format_millis}}
                        <a onclick="vid.pause()">◼</a>
                        &nbsp;
                        <a onclick="vid.currentTime = {{item[0] | to_secs}};vid.play();">►</a>
                        {{item[2]}}
                    </p>
                </div>
                {% endfor %}
            </div>
        </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
<script type="text/javascript">
    
    function findPos(obj) { 
        var curtop = 0; 
        if (obj.offsetParent) { 
            do { 
                curtop += obj.offsetTop; 
            } while (obj = obj.offsetParent); 
            return [curtop]; 
        } 
    }

    var startingOffset = window.location.hash.substring(1);
    if(startingOffset) {
        window.scroll(0,findPos(document.getElementById(startingOffset)));
        document.getElementById(startingOffset).style.fontWeight = "bold"; lastBold = document.getElementById(startingOffset);
    }

    var vid = document.getElementById("audioplayer");
    if(startingOffset){vid.currentTime = startingOffset;}
    var lastBold;
    vid.ontimeupdate = function() {
        myFunction()
    };
    
    function myFunction() {
        {% for item in transcription %}
        if(vid.currentTime <= {{item[1]| to_secs}}) {
            if(lastBold) {
                lastBold.style.fontWeight = "normal";
            }
            lastBold = document.getElementById("segment{{loop.index0}}");
            lastBold.style.fontWeight = "bold"; 
            return;
        }
        {% endfor %}
    }
</script>
    </body>
</html>
